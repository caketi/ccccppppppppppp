# 虚函数对性能损耗的真正原因
[b站谭英智](https://space.bilibili.com/509243533)

不能编译优化为inline
速度慢
cache miss不连续
- cpu cache --- 专门给指令做的cache，在顺序调用虚函数的时候，子类的虚函数一直在cache中，直到遍历完成，才会刷出cache。通过轮询，函数体积大，一下子把cache吃满，cache就有可能被来回的切换，导致性能下降。
- 乱序带来的性能下降 ，并不是虚函数所特有的
- 虚函数带来的性能下降和函数指针带来的性能下降原理一致
- 批量调用虚函数时，内存最好是cache亲和的，尽量不要乱序的调用
- 虚函数时不能被编译优化，短小的函数最好为非虚函数
- 体积大的虚函数，要避免用round robin的轮询方式调用，最好顺序调用